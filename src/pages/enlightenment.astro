<html lang="en">
  <head>
    <title>Enlightenment | BetterNob1e</title>
    <meta name="description" content="A special message for Nob1es." />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { background: #f8fafc; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
      .video-container { background: white; border-radius: 1.5em; box-shadow: 0 4px 32px rgba(80,80,180,0.08); padding: 2em; max-width: 700px; width: 100%; margin: 2em auto; text-align: center; box-sizing: border-box; }
      h1 { color:#3730a3; font-size:2.2em; margin-bottom:0.5em; }
      iframe { border-radius: 1em; box-shadow: 0 2px 16px rgba(99,102,241,0.13); width: 100%; max-width: 560px; height: 315px; }
      #countdown-btn { font-size:1.3em; padding:0.8em 2em; background:#6366f1; color:white; border:none; border-radius:0.6em; font-weight:bold; cursor:not-allowed; opacity:0.7; transition:opacity 0.2s; width: 100%; max-width: 340px; box-sizing: border-box; }
      @media (max-width: 600px) {
        .video-container { padding: 1em; max-width: 98vw; }
        h1 { font-size: 1.3em; }
        iframe { max-width: 100vw; height: 38vw; min-height: 160px; }
        #countdown-btn { font-size: 1em; padding: 0.7em 0.5em; max-width: 98vw; }
      }
    </style>
  </head>
  <body>
    <div class="video-container">
      <h1 style="color:#3730a3; font-size:2.2em; margin-bottom:0.5em;">Your Enlightenment Awaits</h1>
      <iframe id="enlighten-video" width="560" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&enablejsapi=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      <div style="margin-top:2em;">
        <button id="countdown-btn" style="font-size:1.3em; padding:0.8em 2em; background:#6366f1; color:white; border:none; border-radius:0.6em; font-weight:bold; cursor:not-allowed; opacity:0.7; transition:opacity 0.2s;">Please wait 10 seconds...</button>
      </div>
    </div>
    <script>
      let countdown = 10;
      let interval = null;
      let player;
      let ticking = false;
      let paused = false;
      let muted = false;
      let lastPaused = false;
      let lastMuted = false;
      const btn = document.getElementById('countdown-btn');
      function updateBtn() {
        let reason = '';
        if (paused) reason = ' (Video paused)';
        else if (muted) reason = ' (Video muted)';
        if (countdown > 0) {
          btn.textContent = `Please wait ${countdown} second${countdown === 1 ? '' : 's'}...${reason}`;
        } else {
          btn.textContent = 'Get me out of here!';
          btn.disabled = false;
          btn.style.cursor = 'pointer';
          btn.style.opacity = '1';
        }
      }
      btn.disabled = true;
      updateBtn();
      btn.addEventListener('click', function() {
        if (countdown === 0) window.location.href = '/freedom';
      });
      function tick() {
        if (countdown > 0 && !paused && !muted) {
          countdown--;
          updateBtn();
        }
        if (countdown === 0 && interval) {
          clearInterval(interval);
          interval = null;
        }
      }
      function checkMuteState() {
        if (player && typeof player.isMuted === 'function') {
          muted = player.isMuted();
          if (muted && !lastMuted && countdown > 0) {
            countdown += 5;
          }
          lastMuted = muted;
          updateBtn();
        }
      }
      function onPlayerStateChange(event) {
        // 1 = playing, 2 = paused
        paused = (event.data === 2);
        if (paused && !lastPaused && countdown > 0) {
          countdown += 5;
        }
        lastPaused = paused;
        checkMuteState();
        if (event.data === 1 && countdown > 0 && !interval && !muted) {
          interval = setInterval(tick, 1000);
        } else if ((event.data === 2 || muted) && interval) {
          clearInterval(interval);
          interval = null;
        }
        updateBtn();
      }
      function onPlayerReady(event) {
        checkMuteState();
        setInterval(checkMuteState, 300); // Poll mute state every 300ms
      }
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('enlighten-video', {
          events: {
            'onStateChange': onPlayerStateChange,
            'onReady': onPlayerReady
          }
        });
      }
      // Load YouTube IFrame API
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
    </script>
  </body>
</html>
